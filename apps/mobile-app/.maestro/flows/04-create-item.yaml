# Test 04: Create New Item
# Verifies item creation flow
#
# Prerequisites: User is logged in (run 03-successful-login.yaml first)
# Expected: New item is created and visible in vault

appId: net.aliasvault.app
---
# Generate unique item name using timestamp
- runScript:
    file: ../utils/generate-unique-name.js
    env:
      PREFIX: "E2E Test"

# Ensure we're on the items screen (assumes logged in)
- assertVisible:
    id: "items-screen"
    optional: true

# Tap the FAB (Floating Action Button) to add new item
- tapOn:
    id: "add-item-button"

# Wait for add/edit screen to load
- extendedWaitUntil:
    visible:
      id: "add-edit-screen"
    timeout: 10000

- takeScreenshot: "04-1-add-item-screen"

# Enter item name (uses unique name generated by script)
- tapOn:
    id: "item-name-input"
- inputText: ${output.UNIQUE_NAME}

# Enter service URL
- tapOn:
    id: "service-url-input"
- inputText: "https://example.com"

# Add email field (not visible by default for Login type)
- tapOn:
    id: "add-email-button"

# Enter email
- tapOn:
    id: "login-email-input"
- inputText: "e2e-test@example.com"

# Enter username (optional - field may not be visible)
- tapOn:
    id: "login-username-input"
    optional: true
- inputText:
    text: "e2euser"
    optional: true

- hideKeyboard

- takeScreenshot: "04-2-item-filled"

# Save the item
- tapOn:
    id: "save-button"

# Wait for item detail screen to load (app navigates here after save)
- extendedWaitUntil:
    visible:
      text: "Login credentials"
    timeout: 10000

- takeScreenshot: "04-3-item-detail-screen"

# Wait for back button to be ready
- extendedWaitUntil:
    visible: "Wait_for_1_sec"
    optional: true
    timeout: 1000

# Go back to items list
- tapOn:
    id: "back-button"

# Wait for items screen to be visible
- extendedWaitUntil:
    visible:
      id: "items-screen"
    timeout: 10000

# Verify the newly created item appears in the list by tapping on it
- tapOn:
    text: ${output.UNIQUE_NAME}

# Wait for item detail screen to confirm we tapped the right item
- extendedWaitUntil:
    visible:
      text: "Login credentials"
    timeout: 10000

- takeScreenshot: "04-4-item-verified"
